# 工作流方案（端到端）

## 0) 总体策略（为解决核心矛盾）
核心矛盾是“产品必须不变”与“背景必须显著不同”。因此优先采用：
- 产品锁定（Product Lock）：把“产品区域”当成受保护层，避免生成模型改形。
- 背景重构（Background Rebuild）：对背景进行生成/替换，构图与光线变化。
- 出字模板化（Deterministic Text）：规格/说明图的文字尽量用模板渲染而非纯 AI 生成文字，保证一致性与可复现。

## 1) 经理最少操作步骤（目标体验）
1. 上传供应商图片（可多张）。
2. 选择“风格包/模板”（Style Pack，见 [11-风格包-StylePacks.md](11-风格包-StylePacks.md)）。
3. （可选）上传个性化内容：照片/文字/Logo。
4. 一键生成：输出 `showcase + spec + howto` 全部图片。
5. 按 [05-质检与验收清单.md](05-质检与验收清单.md) 做通过/退回。

## 2) 系统模块拆解（实现视角）
### 2.1 输入解析（Intake）
- 输入：供应商图（多张）、可选描述/参考、可选个性化素材。
- 任务：对供应商图做分组（可能包含：白底主图、细节图、规格图、说明图）。
  - 经理采集表：见 [09-输入采集表单-经理填写.md](09-输入采集表单-经理填写.md)

### 2.2 产品分割与锁定（Product Segmentation & Lock）
- 产物：产品蒙版（mask）与产品 cutout（透明 PNG）。
- 用途：后续生成只动背景或做“背景修补”，尽量不触碰产品区域。

### 2.3 背景生成与合成（Background Gen + Composite）
优先级建议（从更稳到更“AI”）：
1. 背景生成 → 产品 cutout 合成 → 加阴影/反射（更容易保证产品不变）
2. 原图背景 inpaint/replace（对产品区域做强约束）
3. 全图重绘（不推荐作为默认，产品改形风险高）

### 2.4 个性化内容融合（Personalization）
- 文字：在固定版式里替换文案（字体/字号遵守规则：内容不同但字体/字号一致）。
- 照片：使用“相似语义”素材库或客户上传照片；保证“不同但相似”。
- Logo/图形：使用同类风格的替代图形（例如同轮廓类别/同视觉风格，但不相同图案）。

### 2.5 规格图与说明图生成（Specs & How-to）
- 规则核心：文本内容/含义必须保持一致，但字体与背景必须变化。
- 最稳路径：背景由生成/图库提供；文字由模板系统渲染（可复现、可控）。

## 3) 仅图片输入也能工作的策略
当缺少文字描述时：
- 先产出 `showcase`：基于产品 cutout + 风格包（场景、光线、构图规则）即可。
- `spec/howto` 的文字来源：
  - 若供应商图中已有规格/说明：做 OCR 抽取（人工复核一次）作为“文本源”。
  - 若供应商图没有：经理在 `09-输入采集表单-经理填写` 里补齐最少字段。

## 4) 质量保障机制（必须内置）
- 生成前：校验输入是否包含关键视角（正面/侧面/细节）。
- 生成中：对产品区域启用“强保护”（mask 不可写/强参考）。
- 生成后：自动检测（尺寸、是否有英文文字、是否缺失产品主体）+ 人工抽检。

## 5) 风格包（Style Pack）建议结构
> 让经理只需要“选风格”，避免写复杂提示词。

- `pack_id`：如 `minimal_white`, `lifestyle_warm`, `premium_dark`
- 场景元素：室内/户外/材质（木纹/大理石/织物）/道具清单
- 光线：柔光/侧逆光/棚拍
- 色调：冷/暖/中性
- 禁用项：强纹理背景、过度反光、与品类冲突的道具

补充：经理可复制的 EN/RU 指令块见 [12-经理指令模板-EN-RU.md](12-经理指令模板-EN-RU.md)。
